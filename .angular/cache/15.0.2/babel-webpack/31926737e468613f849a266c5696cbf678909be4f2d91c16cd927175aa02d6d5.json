{"ast":null,"code":"import { io } from 'socket.io-client';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../pong-ball/pong-ball.component\";\nimport * as i4 from \"../lose-image/lose-image.component\";\nimport * as i5 from \"../player-platforms/player-platforms.component\";\n\nfunction GameComponent_div_0_app_lose_image_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-lose-image\");\n  }\n}\n\nfunction GameComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 3);\n    i0.ɵɵelement(2, \"app-player-platforms\", 4)(3, \"app-pong-ball\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, GameComponent_div_0_app_lose_image_4_Template, 1, 0, \"app-lose-image\", 6);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"socket\", ctx_r0.socket)(\"playersNumbers\", ctx_r0.playersNumbers)(\"currentPlayer\", ctx_r0.currentPlayer)(\"allPlayers\", ctx_r0.allPlayers);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ballPosition\", ctx_r0.ballPosition)(\"socket\", ctx_r0.socket);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r0.currentPlayer == null ? null : ctx_r0.currentPlayer.playerNumber) === ctx_r0.loserPlayerNumber);\n  }\n}\n\nfunction GameComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\", 7);\n    i0.ɵɵtext(1, \"Socket Connection Failed. Try again later\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nconst WS_HOST = process.env.NODE_ENV === 'production' ? location.origin.replace(/^http/, 'ws') : 'ws://localhost:9999/';\nexport class GameComponent {\n  constructor(dialog, renderer, cdr) {\n    this.dialog = dialog;\n    this.renderer = renderer;\n    this.cdr = cdr;\n    this.playersNumbers = [];\n  }\n\n  ngOnInit() {\n    console.log(process.env.NODE_ENV);\n    this.socket = io(WS_HOST, {\n      query: {\n        name: localStorage.getItem('username'),\n        leftValue: 150,\n        platformWidth: 200\n      }\n    });\n    this.socket.on('connected', data => {\n      this.currentPlayer = data.player;\n      this.allPlayers = data.players;\n      this.playersNumbers = this.allPlayers.map(p => p.playerNumber);\n      this.ballPosition = data.ballPosition;\n      this.cdr.detectChanges();\n    });\n    this.socket.on('playerHasLeft', data => {\n      this.allPlayers = this.allPlayers.filter(p => p.playerNumber !== data.playerNumber);\n      this.playersNumbers = this.allPlayers.map(p => p.playerNumber);\n      this.cdr.detectChanges();\n    });\n    this.socket.on('playerConnected', data => {\n      this.allPlayers = [...this.allPlayers, data.player];\n      this.playersNumbers = this.allPlayers.map(p => p.playerNumber);\n      this.cdr.detectChanges();\n    });\n    this.socket.on('countLose', data => {\n      this.allPlayers = this.allPlayers.map(player => {\n        this.loserPlayerNumber = data.playerNumber;\n\n        if (player.playerNumber === data.playerNumber) {\n          return { ...player,\n            loses: data.loses\n          };\n        }\n\n        return player;\n      });\n      this.cdr.detectChanges();\n      setTimeout(() => {\n        this.loserPlayerNumber = null;\n        this.cdr.detectChanges();\n      }, 1500);\n    });\n    this.socket.on('disconnect', () => {\n      console.log('You was disconnected from server, loser');\n    });\n  }\n\n  static #_ = this.ɵfac = function GameComponent_Factory(t) {\n    return new (t || GameComponent)(i0.ɵɵdirectiveInject(i1.MatDialog), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: GameComponent,\n    selectors: [[\"app-game\"]],\n    decls: 3,\n    vars: 2,\n    consts: [[\"class\", \"container\", 4, \"ngIf\", \"ngIfElse\"], [\"socketConnectionFailed\", \"\"], [1, \"container\"], [1, \"game-wrapper\"], [3, \"socket\", \"playersNumbers\", \"currentPlayer\", \"allPlayers\"], [3, \"ballPosition\", \"socket\"], [4, \"ngIf\"], [1, \"m-40\"]],\n    template: function GameComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, GameComponent_div_0_Template, 5, 7, \"div\", 0);\n        i0.ɵɵtemplate(1, GameComponent_ng_template_1_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(2);\n\n        i0.ɵɵproperty(\"ngIf\", ctx.socket == null ? null : ctx.socket.connected)(\"ngIfElse\", _r1);\n      }\n    },\n    dependencies: [i2.NgIf, i3.PongBallComponent, i4.LoseImageComponent, i5.PlayerPlatformsComponent],\n    styles: [\".container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.container[_ngcontent-%COMP%]   .game-wrapper[_ngcontent-%COMP%]{height:500px;width:500px;background:antiquewhite;position:relative}.m-40[_ngcontent-%COMP%]{margin:40px}\"],\n    changeDetection: 0\n  });\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}